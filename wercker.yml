box: debian
pre:
  steps:
    - script:
        name: output message
        code: |
          echo 'ʕ ◔ϖ◔ʔ < build&deployを開始するぞい'

build:
  steps:
    - install-packages:
        packages: git
    - script:
        name: initialize git submodules
        code: |
          git submodule update --init --recursive
    - arjen/hugo-build:
        version: "0.26"
        flags: -v --buildDrafts=false
    - script:
        name: copy wercker.yml
        code: |
          cp wercker.yml public
  after-steps:
    - theollyr/slack-notifier@1.3.1:
         url: $SLACK_URL
         channel: channel-id
         username: wercker_bot
         branch: master
         passed_msg: "ʕ ◔ϖ◔ʔ < success to build!!"
         failed_msg: "ʕ ´ϖ` ʔ < faild to build..."

deploy:
  steps:
    - install-packages:
        packages: git ssh-client curl
    - leipert/git-push:
        gh_oauth: $GIT_TOKEN
        repo: mom0tomo/mom0tomo.github.io
        branch: master
        basedir: public
        gh_pages_domain: mom0tomo.github.io
  after-steps:
    - script:
          name: delete cloudflare cache
    - theollyr/slack-notifier@1.3.1:
         url: $SLACK_URL
         channel: channel-id
         username: wercker_bot
         branch: master
         passed_msg: "ʕ ◔ϖ◔ʔ < success to deploy!!"
         failed_msg: "ʕ ´ϖ` ʔ < faild to deploy..."
